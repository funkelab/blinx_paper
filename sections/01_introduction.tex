\section{Introduction}

% counting structures is important
% super resolution to the rescue
%
Fluorescence microscopy is a foundational tool in the field of biology and
provides useful information on the abundance and localization of labeled
structures.
%
  However, determining the exact molecular count of subunits in a complex
  remains a challenge. Super-resolution techniques such as PALM
  \cite{betzig_imaging_2006}, STORM \cite{rust_sub-diffraction-limit_2006}, and
  DNA-PAINT \cite{schnitzbauer_super-resolution_2017} have addressed this
  problem by achieving resolutions as high as 20nm.

% key concept of super-resolution: fluorescence over time
% doesn't work for many very small structures
%
The underlying principle that overcomes the diffraction limit of light is the
distribution of fluorescence signals from individual fluorophores over time:
%
  only a sparse subset of fluorescent emitters are \introduce{\emph{active}}
  (\ie, emitting light) at each point in time.
  %
  Each spatially distinct emitter can then be localized with sub-pixel accuracy
  by fitting its point spread function. Subsequently, all localizations over
  all frames can be combined into a sub-diffraction limited reconstruction.
  %
  Although the subunits of some complexes can be sufficiently spatially
  separated with super-resolution techniques for visual counting, many exist
  even below this threshold, prompting the need for new methods of molecular
  counting.

% intro to molecular counting for computer scientists: what is the data, what
% do we want to predict?
%
The challenge for molecular counting is then to disentangle the contributions
of multiple fluorescent emitters that overlap in space.
%
  % multiple emitters, single spot
  % intensity trace of combined intensity
  % unknown number of active emitters per timepoint
  % noisy measurements, randomly distributed with unknown parameters
  % dependency on "kinetics" of emitters
  %
  % -> joint inference problem: number of active emitters per timepoint and
  %    parameters
  This problem is ill-posed in a static image, where the intensities of all
  emitters are combined into a single \introduce{spot}. However, the
  fluctuating \introduce{intensity trace} over time can provide enough
  information to infer the number of emitters:
  %
  %While this problem is ill-posed in a static image, the fluctuating
  %\introduce{intensity trace} of the combined intensity of independently
  %blinking emitters over time in a single \introduce{spot} can provide enough
  %information to infer the number of emitters:
  %
  At each timepoint, a subset of all emitters will be active, and thus
  contribute to the combined intensity. Between timepoints, the number of
  active emitters changes accordingly to their underlying \introduce{blinking
  rates}.
  %
  None of the parameters of this process (\eg, intensity of a single emitter,
  probability of activating or deactivating) are known \emph{a-priori} and need
  to be inferred jointly with the total number of emitters.

Here we propose \ours, a differentiable Markov-chain model for intensity
traces, which is conditioned on the total number of emitters, the parameters of
the intensity distribution, and the blinking rates.
%
  \ours allows joint estimation of the parameters of the intensity distribution
  per emitter as well as their blinking rates through maximum likelihood
  optimization.
  %
  The most likely number of emitters per trace is then found as the maximum
  \emph{a-posteriori} solution.

We compare \ours on synthetic traces (where the true number of emitters is
known) and compare its predictions against the current state-of-the-art method,
\lbfcs~\citep{stein_calibration-free_2021}.
%
  \ours is consistently more accurate than \lbfcs and extends the range of
  countable subunits by a factor of two.
  %
  Furthermore, we show that \ours can be used to inform experimental design by
  identifying conditions that facilitate molecular counting.

\paragraph{Related Work}

% molecular counting
Many molecular counting approaches similarly
  make use of imaging over time to extract additional information from the
  system. Some of the simplest systems count events that are designed to happen
  only once per emitter such as photobleaching steps \cite{Ulbrich_subunit_2007} or
  blinks from a 1 time photo-switching emitter
  \cite{gunzenhauser_quantitative_2012}. However, these events are often difficult to
  detect, and can easily be missed leading to severe undercounting.

Other methods make use of emitters that blink repeatedly to reduce the
dependence on individual events.
%
  By modeling the blinking rates of STORM emitters as a continuous time
  Markov process, \cite{patel_blinking_2021, rollins_stochastic_2015} one can extract the total count of emitters
  in a spot. However, these models are limited in accuracy by the complex
  photobleaching nature of the emitters used. Another temporal counting method is
  qPAINT \cite{jungmann_quantitative_2016} which utilizes DNA-PAINT to minimize photobleaching and
  correlates the frequency of repeated binding and unbinding events to the
  molecular count. This method shows an excellent accuracy for counts under 15,
  but relies heavily on previous knowledge of binding rates and is
  susceptible to simultaneous binding events.

Although not precise enough to determine molecular counts, the linear
relationship observed between fluorescence intensity and emitter abundance
\cite{schmied_fluorescence_2012}, provides additional information to improve the
accuracy of these methods.
%
  Many methods use correlation functions to combine both the temporal and
  intensity information to estimate the molecular count, such as balanced
  super-resolution optical fluctuation imaging and fluorescence
  correlation spectroscopy (FCS) which has been used to estimate the copy
  number of specific proteins within the nuclear pore complex
  \cite{otsuka_quantitative_2023}. Similar techniques have also been applied to the
  consistent blinking behavior of DNA-PAINT in lbFCS+ \cite{stein_calibration-free_2021}, which has
  accurately counted up to ~8 molecules and does not rely on previous
  calibrations. These models work by fitting the entire observation series to a
  single equation, in the process greatly simplifying the information. 
